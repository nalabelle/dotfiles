# vim:filetype=zsh

ZDOTDIR="$HOME/.config/zsh"

# https://github.com/jeffreytse/zsh-vi-mode
#. $ZDOTDIR/plugins/zsh-vi-mode/zsh-vi-mode.plugin.zsh
bindkey -v
# allow backspacing over characters to left
bindkey -v '^?' backward-delete-char


# https://github.com/zsh-users/zsh-autosuggestions
. $ZDOTDIR/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh

# https://github.com/Tarrasch/zsh-bd
. $ZDOTDIR/plugins/zsh-bd/bd.zsh

# https://github.com/zsh-users/zsh-syntax-highlighting
. $ZDOTDIR/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

# https://github.com/zsh-users/zsh-history-substring-search

. $ZDOTDIR/plugins/zsh-history-substring-search/zsh-history-substring-search.zsh

# https://linux.die.net/man/1/zshoptions

# Convenience
setopt autocd

# Globbing
setopt nocaseglob
setopt extendedglob
setopt globdots
# Sends unmatched globs to the command
setopt no_nomatch

# History
HISTFILE="$ZDOTDIR/zsh_history"
# How many commands in the history file
SAVEHIST=5000
# How many commands in session history
HISTSIZE=2000
setopt appendhistory
setopt histexpiredupsfirst
setopt histfindnodups
setopt histignorealldups
setopt histignoredups
setopt histnostore
setopt histreduceblanks
setopt incappendhistory
setopt sharehistory

# Put the !! command in the prompt for changing
setopt histverify

# Corrections
setopt correct

key=(
  BackSpace  "${terminfo[kbs]}"
  Home       "${terminfo[khome]}"
  End        "${terminfo[kend]}"
  Insert     "${terminfo[kich1]}"
  Delete     "${terminfo[kdch1]}"
  Up         "${terminfo[kcuu1]}"
  Down       "${terminfo[kcud1]}"
  Left       "${terminfo[kcub1]}"
  Right      "${terminfo[kcuf1]}"
  PageUp     "${terminfo[kpp]}"
  PageDown   "${terminfo[knp]}"
)






zstyle ':vcs_info:*' check-for-changes
zstyle ':vcs_info:*' unstagedstr ' %F{green}U%f'
zstyle ':vcs_info:*' check-for-staged-changes
zstyle ':vcs_info:*' stagedstr ' %F{blue}S%f'
zstyle ':vcs_info:*' actionformats '%F{grey}[%F{yellow}%b%F{grey}|%F{red}%a%F{grey}]%f%c%u%f'
zstyle ':vcs_info:*' formats  '%F{grey}[%F{yellow}%b%c%u%F{grey}]%f'
zstyle ':vcs_info:*' enable git
zstyle ':vcs_info:git*+set-message:*' hooks git-untracked


+vi-git-untracked() {
  if [[ $(git rev-parse --is-inside-work-tree 2> /dev/null) == 'true' ]] && \
     git status --porcelain | grep -m 1 '^??' &>/dev/null
  then
    hook_com[staged]+=' %F{red}T%f'
  fi
}

# Prompt
X_HEADER='%{$fg[blue]%}%0~%{%F{000}%} ${vcs_info_msg_0_}'
PROMPT='%{$fg[white]%}%#%f '
RPROMPT='%F{032}%n@%m%f'
setopt prompt_subst

+x-print-header() {
  print -rP "${X_HEADER}"
}

precmd() {
  vcs_info
  colors
  +x-print-header
  promptinit
}

autoload -U promptinit
autoload -U colors
autoload -Uz vcs_info
autoload -U compinit; compinit
#autoload -U history-search-end

#zle -N history-beginning-search-backward-end history-search-end
#zle -N history-beginning-search-forward-end history-search-end
#bindkey "^[[A" history-beginning-search-backward-end
#bindkey "^[[B" history-beginning-search-forward-end
bindkey '^[[A' history-substring-search-up
bindkey '^[[B' history-substring-search-down


command -v direnv > /dev/null 2>&1 && eval "$(direnv hook zsh)"
